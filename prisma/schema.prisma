generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  entity    String
  entityId  String
  oldData   Json?
  newData   Json?
  ipAddress String?
  userAgent String?
  userId    String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([entity, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

model User {
  id                       String                    @id @default(cuid())
  name                     String?
  email                    String?                   @unique
  phone                    String?                   @unique
  password                 String
  role                     UserRole
  isActive                 Boolean                   @default(true)
  isVerified               Boolean                   @default(false)
  provider                 String?
  providerId               String?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  vendorId                 String?                   @unique
  activityLogs             ActivityLog[]
  auditLogs                AuditLog[]
  blogPosts                BlogPost[]
  carts                    carts?
  conversationParticipants ConversationParticipant[]
  customerProfile          CustomerProfile?
  createdEmployees         Employee[]                @relation("EmployeeCreator")
  employee                 Employee?
  loyaltyTransactions      LoyaltyTransaction[]
  sentMessages             Message[]
  offerUsages              OfferUsage[]              @relation("OfferUsages")
  targetedOffers           OfferUser[]
  createdOffers            Offer[]                   @relation("OfferCreatedByUser")
  orders                   Order[]
  approvedProducts         Product[]                 @relation("ProductApprover")
  reviews                  Review[]
  assignedTickets          SupportTicket[]           @relation("AssignedTickets")
  tickets                  SupportTicket[]           @relation("UserTickets")
  createdTerms             TermsAndConditions[]      @relation("TermsCreator")
  updatedTerms             TermsAndConditions[]      @relation("TermsUpdater")
  ticketMessages           TicketMessage[]           @relation("TicketMessages")
  userAddresses            UserAddress[]
  vendor                   Vendor?                   @relation("UserVendor", fields: [vendorId], references: [id])
  followedVendors          VendorFollower[]          @relation("UserFollowedVendors")
  walletTransactions       WalletTransaction[]
  wishlists                wishlists?

  @@map("users")
}

model Vendor {
  id                       String                     @id @default(cuid())
  storeName                String
  avatar                   String?
  email                    String?
  status                   VendorStatus               @default(PENDING)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  currentCommissionRate    Float?                     @default(0)
  accountType              AccountType                @default(INDIVIDUAL)
  businessType             BusinessType?
  verificationStatus       VerificationStatus         @default(PENDING)
  verifiedAt               DateTime?
  rejectedAt               DateTime?
  rejectionReason          String?
  sliders                  Slider[]                   @relation("VendorSliders")
  folders                  VendorFolder[]
  advertisements           Advertisement[]            @relation("VendorAdvertisements")
  conversationParticipants ConversationParticipant[]  @relation("VendorParticipants")
  courier_credentials      CourierCredential[]
  courier_orders           CourierOrder[]
  courier_pricing_rules    CourierPricingRules[]
  employees                Employee[]                 @relation("VendorEmployees")
  sentMessages             Message[]                  @relation("VendorSentMessages")
  offerPermissions         OfferPermission?
  targetedByOffers         OfferVendor[]              @relation("TargetedOffers")
  createdOffers            Offer[]                    @relation("OfferCreatedByVendor")
  orders                   VendorOrder[]
  products                 Product[]
  storageFiles             StorageFile[]
  bannerCustomization      StoreBannerCustomization?  @relation("VendorBannerCustomization")
  storeLayout              StoreLayout?               @relation("VendorStoreLayout")
  user                     User?                      @relation("UserVendor")
  pickupAddress            VendorAddress?
  warehouses               VendorWarehouse[]
  bankInfo                 VendorBankInfo?
  commissions              VendorCommission[]
  documents                VendorDocument[]
  flags                    VendorFlag[]
  followers                VendorFollower[]           @relation("VendorFollowers")
  messagingSettings        VendorMessagingSetting?
  monthlyCharges           VendorMonthlyCharge[]
  onboarding               VendorOnboardingChecklist?
  payouts                  VendorPayout[]
  performance              VendorPerformance?
  personalInfo             VendorPersonalInfo?
  settings                 VendorSettings?
  storageCharges           VendorStorageCharge[]
  storageUsage             VendorStorageUsage?
  subscription             VendorSubscription?

  @@map("vendors")
}

model VendorPersonalInfo {
  id            String   @id @default(cuid())
  vendorId      String   @unique
  idNumber      String?
  idName        String?
  companyName   String?
  businessRegNo String?
  taxIdNumber   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  vendor        Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_personal_info")
}

model VendorAddress {
  id             String   @id @default(cuid())
  vendorId       String   @unique
  detailsAddress String?
  city           String?
  zone           String?
  area           String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  vendor         Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_addresses")
}

model VendorBankInfo {
  id            String   @id @default(cuid())
  vendorId      String   @unique
  accountName   String
  accountNumber String
  bankName      String
  branchName    String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  vendor        Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_bank_info")
}

model VendorDocument {
  id                 String                     @id @default(cuid())
  vendorId           String
  type               DocumentType
  title              String
  filePath           String
  verificationStatus DocumentVerificationStatus @default(PENDING)
  createdAt          DateTime                   @default(now())
  updatedAt          DateTime                   @updatedAt
  vendor             Vendor                     @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId])
  @@map("vendor_documents")
}

model VendorSettings {
  id                 String   @id @default(cuid())
  vendorId           String   @unique
  emailNotifications Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  vendor             Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_settings")
}

model VendorSubscription {
  id        String           @id @default(cuid())
  vendorId  String           @unique
  planType  SubscriptionPlan @default(FREE)
  isActive  Boolean          @default(true)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  vendor    Vendor           @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_subscriptions")
}

model VendorOnboardingChecklist {
  id                   String   @id @default(cuid())
  vendorId             String   @unique
  personalInfoComplete Boolean  @default(false)
  addressComplete      Boolean  @default(false)
  bankInfoComplete     Boolean  @default(false)
  documentsComplete    Boolean  @default(false)
  overallComplete      Boolean  @default(false)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  vendor               Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_onboarding_checklist")
}

model VendorCommission {
  id         String    @id @default(cuid())
  vendorId   String
  categoryId String?
  rate       Float
  createdAt  DateTime  @default(now())
  category   Category? @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  vendor     Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([vendorId, categoryId])
  @@map("vendor_commissions")
}

model VendorPayout {
  id        String       @id @default(cuid())
  vendorId  String
  amount    Float
  status    PayoutStatus @default(PENDING)
  method    String?
  period    String?
  note      String?
  createdAt DateTime     @default(now())
  paidAt    DateTime?
  vendor    Vendor       @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_payouts")
}

model VendorMonthlyCharge {
  id            String    @id @default(cuid())
  vendorId      String
  amount        Float
  description   String?
  effectiveFrom DateTime  @default(now())
  effectiveTo   DateTime?
  createdAt     DateTime  @default(now())
  vendor        Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_monthly_charges")
}

model VendorFlag {
  id        String   @id @default(cuid())
  vendorId  String
  reason    String
  severity  Int      @default(1)
  meta      Json?
  createdAt DateTime @default(now())
  vendor    Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_flags")
}

model VendorPerformance {
  id                 String    @id @default(cuid())
  vendorId           String    @unique
  totalSales         Float     @default(0)
  totalOrders        Int       @default(0)
  fulfillmentRatePct Float     @default(100)
  avgRating          Float     @default(0)
  lastCalculatedAt   DateTime?
  vendor             Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_performance")
}

model VendorMessagingSetting {
  id          String   @id @default(cuid())
  vendorId    String   @unique
  isAvailable Boolean  @default(true)
  autoReply   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  vendor      Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_messaging_settings")
}

model VendorFollower {
  id         String   @id @default(cuid())
  vendorId   String
  userId     String
  followedAt DateTime @default(now())
  user       User     @relation("UserFollowedVendors", fields: [userId], references: [id], onDelete: Cascade)
  vendor     Vendor   @relation("VendorFollowers", fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([vendorId, userId])
  @@index([vendorId])
  @@index([userId])
  @@map("vendor_followers")
}

model VendorStorageUsage {
  id                String    @id @default(cuid())
  vendorId          String    @unique
  totalUsedBytes    BigInt    @default(0)
  freeQuotaBytes    BigInt    @default(5368709120)
  paidQuotaBytes    BigInt    @default(0)
  totalQuotaBytes   BigInt    @default(5368709120)
  totalFiles        Int       @default(0)
  imageFiles        Int       @default(0)
  documentFiles     Int       @default(0)
  lastCalculatedAt  DateTime  @default(now())
  currentMonthUsage BigInt    @default(0)
  lastBilledAt      DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  vendor            Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_storage_usage")
}

model VendorStorageCharge {
  id              String    @id @default(cuid())
  vendorId        String
  billingPeriod   String
  usedBytes       BigInt
  chargeableBytes BigInt
  pricePerGB      Float
  totalCharge     Float
  isPaid          Boolean   @default(false)
  paidAt          DateTime?
  createdAt       DateTime  @default(now())
  vendor          Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId, billingPeriod])
  @@map("vendor_storage_charges")
}

model StorageFile {
  id           String    @id @default(cuid())
  vendorId     String
  fileName     String
  fileKey      String    @unique
  fileSize     BigInt
  mimeType     String
  fileType     String
  productId    String?
  variantId    String?
  documentType String?
  r2Bucket     String
  r2Url        String
  r2ETag       String?
  folder       String?
  isActive     Boolean   @default(true)
  deletedAt    DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  vendor       Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId, isActive])
  @@index([fileKey])
  @@index([folder])
  @@map("storage_files")
}

model VendorFolder {
  id         String   @id @default(cuid())
  vendorId   String
  name       String
  path       String   @unique
  parentPath String?
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  vendor     Vendor   @relation(fields: [vendorId], references: [id])

  @@index([vendorId])
  @@index([path])
}

model Employee {
  id                       String                    @id @default(cuid())
  designation              String?
  department               String?
  permissions              Json
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  userId                   String?                   @unique
  createdById              String?
  vendorId                 String?
  isActive                 Boolean                   @default(true)
  conversationParticipants ConversationParticipant[]
  createdBy                User?                     @relation("EmployeeCreator", fields: [createdById], references: [id])
  user                     User?                     @relation(fields: [userId], references: [id])
  vendor                   Vendor?                   @relation("VendorEmployees", fields: [vendorId], references: [id])
  sentMessages             Message[]

  @@map("employees")
}

model CustomerProfile {
  id            String  @id @default(cuid())
  userId        String  @unique
  address       String?
  phone         String?
  wallet        Float   @default(0)
  loyaltyPoints Int     @default(0)
  user          User    @relation(fields: [userId], references: [id])

  @@map("customer_profiles")
}

model DeliveryPerson {
  id                       String                    @id @default(cuid())
  userId                   String?
  name                     String
  phone                    String
  isActive                 Boolean                   @default(true)
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  conversationParticipants ConversationParticipant[]
  collections              DeliveryCollection[]
  payouts                  DeliveryPayout[]
  sentMessages             Message[]

  @@map("delivery_persons")
}

model Conversation {
  id              String                    @id @default(cuid())
  type            ConversationType
  productId       String?
  orderId         String?
  title           String?
  status          String                    @default("OPEN")
  lastMessageAt   DateTime?
  lastMessageText String?
  messageCount    Int                       @default(0)
  unreadCount     Int                       @default(0)
  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt
  participants    ConversationParticipant[]
  order           Order?                    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product         Product?                  @relation(fields: [productId], references: [id], onDelete: Cascade)
  messages        Message[]

  @@index([type, lastMessageAt])
  @@index([productId, lastMessageAt])
  @@index([orderId, lastMessageAt])
  @@index([lastMessageAt])
  @@map("conversations")
}

model ConversationParticipant {
  id               String          @id @default(cuid())
  conversationId   String
  userId           String?
  vendorId         String?
  employeeId       String?
  deliveryPersonId String?
  participantType  ParticipantType
  lastReadAt       DateTime?
  joinedAt         DateTime        @default(now())
  leftAt           DateTime?
  isMuted          Boolean         @default(false)
  conversation     Conversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  deliveryPerson   DeliveryPerson? @relation(fields: [deliveryPersonId], references: [id], onDelete: Cascade)
  employee         Employee?       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  user             User?           @relation(fields: [userId], references: [id], onDelete: Cascade)
  vendor           Vendor?         @relation("VendorParticipants", fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId, vendorId, employeeId, deliveryPersonId])
  @@map("conversation_participants")
}

model Message {
  id                     String          @id @default(cuid())
  conversationId         String
  senderId               String?
  senderVendorId         String?
  senderEmployeeId       String?
  senderDeliveryPersonId String?
  senderType             ParticipantType
  content                String
  status                 MessageStatus   @default(SENT)
  deliveredAt            DateTime?
  seenAt                 DateTime?
  createdAt              DateTime        @default(now())
  conversation           Conversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  senderDelivery         DeliveryPerson? @relation(fields: [senderDeliveryPersonId], references: [id], onDelete: Cascade)
  senderEmployee         Employee?       @relation(fields: [senderEmployeeId], references: [id], onDelete: Cascade)
  senderUser             User?           @relation(fields: [senderId], references: [id], onDelete: Cascade)
  senderVendor           Vendor?         @relation("VendorSentMessages", fields: [senderVendorId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@index([createdAt])
  @@index([senderType, createdAt])
  @@map("messages")
}

model Category {
  id                  String              @id @default(cuid())
  name                String
  slug                String              @unique
  image               String?
  parentId            String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  keywords            String[]
  tags                String[]
  categoryTemplate    CategoryTemplate?
  parent              Category?           @relation("CategoryToChildren", fields: [parentId], references: [id], onDelete: Cascade)
  children            Category[]          @relation("CategoryToChildren")
  attributes          CategoryAttribute[]
  componentCategories ComponentCategory[] @relation("ComponentCategories")
  offerCategories     OfferCategory[]
  products            Product[]
  vendorCommissions   VendorCommission[]

  @@map("categories")
}

model CategoryAttribute {
  id          String    @id @default(cuid())
  categoryId  String
  attributeId String
  isRequired  Boolean   @default(false)
  filterable  Boolean   @default(true)
  sortOrder   Int       @default(0)
  attribute   Attribute @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  category    Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, attributeId])
  @@index([categoryId, sortOrder])
  @@map("category_attributes")
}

model Attribute {
  id                String              @id @default(cuid())
  name              String
  slug              String              @unique
  type              AttributeType
  unit              String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  values            AttributeValue[]
  categories        CategoryAttribute[]
  productAttributes ProductAttribute[]

  @@map("attributes")
}

model AttributeValue {
  id                String                    @id @default(cuid())
  value             String
  attributeId       String
  createdAt         DateTime                  @default(now())
  updatedAt         DateTime                  @updatedAt
  attribute         Attribute                 @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  productAttributes ProductAttribute[]
  variants          ProductVariantAttribute[]

  @@unique([attributeId, value])
  @@map("attribute_values")
}

model CategoryTemplate {
  id         String   @id @default(uuid())
  categoryId String   @unique
  filePath   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  category   Category @relation(fields: [categoryId], references: [id])
}

model Product {
  id                String                @id @default(cuid())
  name              String
  nameBn            String?
  description       String?
  slug              String                @unique
  vendorId          String
  categoryId        String
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  approvalStatus    ProductApprovalStatus @default(PENDING)
  approvedById      String?
  buyXOffers        BuyXGetYOffer[]       @relation("BuyProduct")
  getYOffers        BuyXGetYOffer[]       @relation("GetProduct")
  cart_items        cart_items[]
  componentProducts ComponentProduct[]
  conversations     Conversation[]
  offerProducts     OfferProduct[]
  attributes        ProductAttribute[]
  images            ProductImage[]
  variants          ProductVariant[]
  approvedBy        User?                 @relation("ProductApprover", fields: [approvedById], references: [id])
  category          Category              @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  vendor            Vendor                @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  reviews           Review[]
  warranty          Warranty?
  wishlist_items    wishlist_items[]

  @@map("products")
}

model ProductAttribute {
  id               String          @id @default(cuid())
  productId        String
  attributeId      String
  isForVariant     Boolean         @default(false)
  valueString      String?
  valueNumber      Float?
  valueBoolean     Boolean?
  attributeValueId String?
  attribute        Attribute       @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  attributeValue   AttributeValue? @relation(fields: [attributeValueId], references: [id])
  product          Product         @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, attributeId])
  @@index([productId, isForVariant])
  @@map("product_attributes")
}

model ProductImage {
  id        String          @id @default(cuid())
  productId String?
  variantId String?
  url       String
  altText   String?
  sortOrder Int?
  createdAt DateTime        @default(now())
  product   Product?        @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant   ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@map("product_images")
}

model ProductVariant {
  id             String                    @id @default(cuid())
  productId      String
  name           String?
  sku            String                    @unique
  price          Float
  specialPrice   Float?
  discount       Int?
  stock          Int                       @default(0)
  createdAt      DateTime                  @default(now())
  updatedAt      DateTime                  @updatedAt
  availability   Boolean?                  @default(true)
  cart_items     cart_items[]
  orderItems     OrderItem[]
  images         ProductImage[]
  attributes     ProductVariantAttribute[]
  product        Product                   @relation(fields: [productId], references: [id], onDelete: Cascade)
  wishlist_items wishlist_items[]

  @@map("product_variants")
}

model ProductVariantAttribute {
  id               String         @id @default(cuid())
  variantId        String
  attributeValueId String
  attributeValue   AttributeValue @relation(fields: [attributeValueId], references: [id], onDelete: Cascade)
  variant          ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([variantId, attributeValueId])
  @@map("product_variant_attributes")
}

model Review {
  id        String   @id @default(cuid())
  userId    String
  productId String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("reviews")
}

model Warranty {
  id                 String         @id @default(cuid())
  productId          String         @unique
  packageWeightValue Float
  packageWeightUnit  WeightUnit
  packageLength      Float
  packageWidth       Float
  packageHeight      Float
  dangerousGoods     DangerousGoods
  duration           Int
  unit               WarrantyUnit
  policy             String?
  type               WarrantyType
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  product            Product        @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("warranties")
}

model OfferPermission {
  id                     String   @id @default(cuid())
  vendorId               String   @unique
  canCreateRegular       Boolean  @default(true)
  canCreateVoucher       Boolean  @default(true)
  canCreateCountdown     Boolean  @default(true)
  canCreateFlashSale     Boolean  @default(false)
  canCreateBuyXGetY      Boolean  @default(false)
  canCreateFreeShipping  Boolean  @default(false)
  canCreateBundleDeal    Boolean  @default(false)
  canCreateSeasonalSale  Boolean  @default(true)
  canCreateLoyaltyReward Boolean  @default(false)
  canCreateReferralBonus Boolean  @default(false)
  maxActiveOffers        Int      @default(10)
  maxDiscountPercent     Float    @default(50)
  maxDiscountAmount      Float    @default(500)
  maxVouchersPerOffer    Int?
  maxFlashSaleDuration   Int?
  maxBundleItems         Int?
  requiresApproval       Boolean  @default(true)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  vendor                 Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("offer_permissions")
}

model Offer {
  id                 String           @id @default(cuid())
  title              String
  description        String?
  slug               String           @unique
  type               OfferType
  discountType       DiscountType
  discountValue      Float
  maxDiscountAmount  Float?
  minOrderAmount     Float?
  status             OfferStatus      @default(PENDING)
  validFrom          DateTime
  validTo            DateTime?
  isActive           Boolean          @default(true)
  totalUsageLimit    Int?
  userUsageLimit     Int?
  currentUsageCount  Int              @default(0)
  isPublic           Boolean          @default(true)
  applicableToAll    Boolean          @default(true)
  createdByType      CreatorType
  createdByUserId    String?
  createdByVendorId  String?
  priority           Int              @default(0)
  bannerImage        String?
  termsAndConditions String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  buyXGetYOffer      BuyXGetYOffer?
  offerStackRules    OfferStackRule[]
  countdownConfig    CountdownOffer?
  analytics          OfferAnalytics[]
  targetCategories   OfferCategory[]
  targetProducts     OfferProduct[]
  usageHistory       OfferUsage[]
  targetUsers        OfferUser[]
  targetVendors      OfferVendor[]
  createdByUser      User?            @relation("OfferCreatedByUser", fields: [createdByUserId], references: [id])
  createdByVendor    Vendor?          @relation("OfferCreatedByVendor", fields: [createdByVendorId], references: [id], onDelete: Cascade)
  voucherConfig      VoucherOffer?

  @@map("offers")
}

model CountdownOffer {
  id            String   @id @default(cuid())
  offerId       String   @unique
  originalPrice Float?
  flashPrice    Float?
  quantityLimit Int?
  remainingQty  Int?
  countdownEnds DateTime
  showCountdown Boolean  @default(true)
  urgencyText   String?
  scarcityText  String?
  offer         Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)

  @@map("countdown_offers")
}

model VoucherOffer {
  id              String  @id @default(cuid())
  offerId         String  @unique
  code            String  @unique
  isAutoGenerated Boolean @default(false)
  isPublic        Boolean @default(true)
  requiresCode    Boolean @default(true)
  firstTimeOnly   Boolean @default(false)
  offer           Offer   @relation(fields: [offerId], references: [id], onDelete: Cascade)

  @@map("voucher_offers")
}

model BuyXGetYOffer {
  id           String  @id @default(cuid())
  offerId      String  @unique
  buyProductId String
  getProductId String
  buyQuantity  Int     @default(1)
  getQuantity  Int     @default(1)
  buyProduct   Product @relation("BuyProduct", fields: [buyProductId], references: [id], onDelete: Cascade)
  getProduct   Product @relation("GetProduct", fields: [getProductId], references: [id], onDelete: Cascade)
  offer        Offer   @relation(fields: [offerId], references: [id], onDelete: Cascade)
}

model OfferStackRule {
  id                        String  @id @default(cuid())
  offerId                   String
  canCombineWithOtherOffers Boolean @default(false)
  maxStackCount             Int     @default(1)
  offer                     Offer   @relation(fields: [offerId], references: [id], onDelete: Cascade)
}

model OfferProduct {
  id            String  @id @default(cuid())
  offerId       String
  productId     String
  discountValue Float?
  offer         Offer   @relation(fields: [offerId], references: [id], onDelete: Cascade)
  product       Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([offerId, productId])
  @@map("offer_products")
}

model OfferCategory {
  id         String   @id @default(cuid())
  offerId    String
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  offer      Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)

  @@unique([offerId, categoryId])
  @@map("offer_categories")
}

model OfferVendor {
  id       String @id @default(cuid())
  offerId  String
  vendorId String
  offer    Offer  @relation(fields: [offerId], references: [id], onDelete: Cascade)
  vendor   Vendor @relation("TargetedOffers", fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([offerId, vendorId])
  @@map("offer_vendors")
}

model OfferUser {
  id      String @id @default(cuid())
  offerId String
  userId  String
  offer   Offer  @relation(fields: [offerId], references: [id], onDelete: Cascade)
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([offerId, userId])
  @@map("offer_users")
}

model OfferUsage {
  id              String   @id @default(cuid())
  offerId         String
  userId          String
  orderId         String?
  discountApplied Float
  orderAmount     Float
  usedAt          DateTime @default(now())
  offer           Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)
  order           Order?   @relation(fields: [orderId], references: [id])
  user            User     @relation("OfferUsages", fields: [userId], references: [id], onDelete: Cascade)

  @@map("offer_usage")
}

model OfferAnalytics {
  id             String   @id @default(cuid())
  offerId        String
  totalViews     Int      @default(0)
  totalClicks    Int      @default(0)
  totalUsage     Int      @default(0)
  totalRevenue   Float    @default(0)
  conversionRate Float    @default(0)
  avgOrderValue  Float    @default(0)
  recordDate     DateTime @default(now())
  offer          Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)

  @@unique([offerId, recordDate])
  @@map("offer_analytics")
}

model Order {
    id                   String     @id @default(cuid())

  orderNumber       String?           @unique
  userId            String?
  totalAmount       Float
  subtotal          Float?
  shippingCost      Float?            @default(0)
  tax               Float?            @default(0)
  discountAmount    Float?            @default(0)

  status            OrderStatus
  paymentStatus     PaymentStatus     @default(PENDING)
  fulfillmentStatus FulfillmentStatus @default(UNFULFILLED)

  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  confirmedAt       DateTime
  paidAt            DateTime?
  cancelledAt       DateTime?

  conversionSource  String?
  deviceType        String?

  // Relations
  user              User?             @relation(fields: [userId], references: [id])
  vendorOrders      VendorOrder[]     
  address           OrderAddress?
  conversations     Conversation[]
  offerUsages       OfferUsage[]
  checkoutSessions CheckoutSession[]

  payments          Payment[]
  refunds           Refund[]

  @@index([userId])
  @@map("orders")
}
model VendorOrder {
  id                   String     @id @default(cuid())
  orderId              String
  vendorId             String

  subtotal             Float
  shippingCost         Float      @default(0)

  status               OrderStatus
  fulfillmentStatus    FulfillmentStatus @default(UNFULFILLED)

  createdAt            DateTime   @default(now())
  shippedAt            DateTime?
  deliveredAt          DateTime?
  cancelledAt          DateTime?

  // Relations
  order                Order      @relation(fields: [orderId], references: [id], onDelete: Cascade)
  vendor               Vendor     @relation(fields: [vendorId], references: [id])
  items                OrderItem[]
  deliveryCollections  DeliveryCollection[]

  // âœ… FIXED RELATION
  courierOrderId       String?
  courierOrder         CourierOrder? @relation(fields: [courierOrderId], references: [id])

  @@index([vendorId])
  @@map("vendor_orders")
}



model OrderItem {
  id             String         @id @default(cuid())
  vendorOrderId  String
  variantId      String
  quantity       Int
  price          Float

  vendorOrder    VendorOrder   @relation(fields: [vendorOrderId], references: [id], onDelete: Cascade)
  variant        ProductVariant @relation(fields: [variantId], references: [id])

  @@map("order_items")
}


model Payment {
  id        String        @id @default(cuid())
  orderId   String
  method    String
  amount    Float
  status    PaymentStatus @default(PENDING)
  meta      Json?
  createdAt DateTime      @default(now())
  paidAt    DateTime?
  order     Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model Refund {
  id          String       @id @default(cuid())
  orderId     String
  amount      Float
  reason      String?
  status      RefundStatus @default(PENDING)
  createdAt   DateTime     @default(now())
  processedAt DateTime?
  order       Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("refunds")
}

model DeliveryCollection {
  id               String         @id @default(cuid())
  deliveryPersonId String
  vendorOrderId    String
  amountCollected  Float
  createdAt        DateTime       @default(now())

  deliveryPerson   DeliveryPerson @relation(fields: [deliveryPersonId], references: [id])
  vendorOrder      VendorOrder    @relation(fields: [vendorOrderId], references: [id], onDelete: Cascade)
  

  @@map("delivery_collections")
}


model DeliveryPayout {
  id               String         @id @default(cuid())
  deliveryPersonId String
  amount           Float
  status           PayoutStatus   @default(PENDING)
  createdAt        DateTime       @default(now())
  paidAt           DateTime?
  deliveryPerson   DeliveryPerson @relation(fields: [deliveryPersonId], references: [id], onDelete: Cascade)

  @@map("delivery_payouts")
}

model Banner {
  id        String   @id @default(cuid())
  title     String
  imageUrl  String
  link      String?
  position  String
  priority  Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("banners")
}

model BlogPost {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  body        String
  authorId    String?
  published   Boolean   @default(false)
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  author      User?     @relation(fields: [authorId], references: [id])

  @@map("blog_posts")
}

model Faq {
  id         String   @id @default(cuid())
  category   String
  question   String
  answer     String
  isActive   Boolean
  orderIndex Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("faqs")
}

model Coupon {
  id            String     @id @default(cuid())
  code          String     @unique
  description   String?
  discountType  CouponType
  discountValue Float
  validFrom     DateTime
  validTo       DateTime?
  usageLimit    Int?
  createdAt     DateTime   @default(now())
  isActive      Boolean    @default(true)

  @@map("coupons")
}

model Campaign {
  id        String    @id @default(cuid())
  title     String
  channels  String[]
  payload   Json
  startedAt DateTime?
  endedAt   DateTime?
  createdAt DateTime  @default(now())

  @@map("campaigns")
}

model Advertisement {
  id        String    @id @default(cuid())
  title     String
  vendorId  String?
  position  String
  startAt   DateTime
  endAt     DateTime?
  isActive  Boolean   @default(true)
  meta      Json?
  createdAt DateTime  @default(now())
  vendor    Vendor?   @relation("VendorAdvertisements", fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("advertisements")
}

model Report {
  id        String   @id @default(cuid())
  key       String
  payload   Json
  createdAt DateTime @default(now())

  @@map("reports")
}

model ActivityLog {
  id        String   @id @default(cuid())
  userId    String?
  action    String
  entity    String?
  entityId  String?
  meta      Json?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("activity_logs")
}

model SeoConfig {
  id        String   @id @default(cuid())
  page      String
  metaTitle String?
  metaDesc  String?
  metaJson  Json?
  updatedAt DateTime @updatedAt

  @@map("seo_configs")
}

model PushNotification {
  id        String    @id @default(cuid())
  title     String
  body      String
  target    Json?
  sentAt    DateTime?
  createdAt DateTime  @default(now())

  @@map("push_notifications")
}

model ReferralBonus {
  id        String    @id @default(cuid())
  code      String    @unique
  reward    Json
  createdAt DateTime  @default(now())
  expiresAt DateTime?
  isActive  Boolean   @default(true)

  @@map("referral_bonuses")
}

model Survey {
  id        String   @id @default(cuid())
  title     String
  questions Json
  active    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("surveys")
}

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt

  @@map("settings")
}

model PaymentGateway {
  id        String   @id @default(cuid())
  provider  String
  config    Json
  enabled   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("payment_gateways")
}

model Currency {
  id         String   @id @default(cuid())
  code       String   @unique
  symbol     String
  rateToBase Float    @default(1)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())

  @@map("currencies")
}

model BackupJob {
  id         String    @id @default(cuid())
  type       String
  status     String
  meta       Json?
  createdAt  DateTime  @default(now())
  finishedAt DateTime?

  @@map("backup_jobs")
}

model WalletTransaction {
  id          String                @id @default(cuid())
  userId      String
  amount      Float
  type        WalletTransactionType
  description String?
  createdAt   DateTime              @default(now())
  user        User                  @relation(fields: [userId], references: [id])

  @@map("wallet_transactions")
}

model LoyaltyTransaction {
  id          String                 @id @default(cuid())
  userId      String
  points      Int
  type        LoyaltyTransactionType
  description String?
  createdAt   DateTime               @default(now())
  user        User                   @relation(fields: [userId], references: [id])

  @@map("loyalty_transactions")
}

model Slider {
  id          String     @id @default(cuid())
  title       String?
  subtitle    String?
  description String?
  imageUrl    String
  link        String?
  buttonText  String?
  buttonLink  String?
  type        SliderType
  vendorId    String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  vendor      Vendor?    @relation("VendorSliders", fields: [vendorId], references: [id])
}

model TermsAndConditions {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  content     String
  version     String
  isActive    Boolean   @default(false)
  isPublished Boolean   @default(false)
  createdById String?
  updatedById String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  publishedAt DateTime?
  type        TermsType @default(GENERAL)
  language    String    @default("en")
  metaTitle   String?
  metaDesc    String?
  createdBy   User?     @relation("TermsCreator", fields: [createdById], references: [id])
  updatedBy   User?     @relation("TermsUpdater", fields: [updatedById], references: [id])

  @@index([isActive, isPublished])
  @@index([type, isActive])
  @@map("terms_and_conditions")
}

model StoreLayout {
  id         String                 @id @default(cuid())
  vendorId   String                 @unique
  isDefault  Boolean                @default(false)
  thumbnail  String?
  createdAt  DateTime               @default(now())
  updatedAt  DateTime               @updatedAt
  components StoreLayoutComponent[]
  vendor     Vendor                 @relation("VendorStoreLayout", fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId])
  @@map("store_layouts")
}

model StoreLayoutComponent {
  id         String              @id @default(cuid())
  layoutId   String
  type       ComponentType
  sortOrder  Int                 @default(0)
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  categories ComponentCategory[]
  config     ComponentConfig?
  products   ComponentProduct[]
  layout     StoreLayout         @relation(fields: [layoutId], references: [id], onDelete: Cascade)

  @@index([layoutId, sortOrder])
  @@index([type])
  @@map("store_layout_components")
}

model ComponentConfig {
  id                       String               @id @default(cuid())
  componentId              String               @unique
  bannerImage              String?
  bannerBackgroundType     BackgroundType?
  bannerBackgroundColor    String?
  showChatButton           Boolean              @default(true)
  showRating               Boolean              @default(true)
  showVerifiedBadge        Boolean              @default(true)
  showFollowers            Boolean              @default(true)
  showLogo                 Boolean              @default(true)
  showStoreName            Boolean              @default(true)
  categoryLayout           CategoryLayout?
  categoriesPerRow         Int?
  showCategoryCount        Boolean              @default(true)
  categorySlideInterval    Int?
  productsPerRow           Int?
  showProductPrice         Boolean              @default(true)
  showProductRating        Boolean              @default(true)
  showAddToCart            Boolean              @default(true)
  autoSlide                Boolean              @default(false)
  slideInterval            Int?
  bannerType               BannerType?
  bannerLayout             BannerLayout?
  bannerHeight             String?
  bannerImages             Json?
  countdownBannerImage     String?
  countdownEndDate         DateTime?
  timerPosition            TimerPosition?
  showDays                 Boolean              @default(true)
  showHours                Boolean              @default(true)
  showMinutes              Boolean              @default(true)
  showSeconds              Boolean              @default(true)
  countdownTitle           String?
  countdownBackgroundColor String?
  voucherBannerImage       String?
  voucherCode              String?
  voucherTitle             String?
  voucherDescription       String?
  voucherBackgroundColor   String?
  voucherTextColor         String?
  minOrderAmount           Float?
  discountAmount           Float?
  discountPercentage       Float?
  voucherValidFrom         DateTime?
  voucherValidTo           DateTime?
  showVoucherCode          Boolean              @default(true)
  useDefaultDesign         Boolean              @default(true)
  customCSS                String?
  padding                  String?
  margin                   String?
  borderRadius             String?
  boxShadow                String?
  createdAt                DateTime             @default(now())
  updatedAt                DateTime             @updatedAt
  component                StoreLayoutComponent @relation(fields: [componentId], references: [id], onDelete: Cascade)

  @@map("component_configs")
}

model ComponentProduct {
  id          String               @id @default(cuid())
  componentId String
  productId   String
  sortOrder   Int                  @default(0)
  isFeatured  Boolean              @default(false)
  createdAt   DateTime             @default(now())
  component   StoreLayoutComponent @relation(fields: [componentId], references: [id], onDelete: Cascade)
  product     Product              @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([componentId, productId])
  @@index([componentId, sortOrder])
  @@map("component_products")
}

model ComponentCategory {
  id          String               @id @default(cuid())
  componentId String
  categoryId  String
  sortOrder   Int                  @default(0)
  isFeatured  Boolean              @default(false)
  createdAt   DateTime             @default(now())
  category    Category             @relation("ComponentCategories", fields: [categoryId], references: [id], onDelete: Cascade)
  component   StoreLayoutComponent @relation(fields: [componentId], references: [id], onDelete: Cascade)

  @@unique([componentId, categoryId])
  @@index([componentId, sortOrder])
  @@map("component_categories")
}

model StoreBannerCustomization {
  id                    String         @id @default(cuid())
  vendorId              String         @unique
  bannerImage           String?
  bannerBackgroundType  BackgroundType @default(SOLID)
  bannerBackgroundValue String?
  showChatButton        Boolean        @default(true)
  showRating            Boolean        @default(true)
  showVerifiedBadge     Boolean        @default(true)
  showFollowers         Boolean        @default(true)
  chatButtonColor       String         @default("#14B8A6")
  storeNameColor        String         @default("#000000")
  textColor             String         @default("#666666")
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
  vendor                Vendor         @relation("VendorBannerCustomization", fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("store_banner_customizations")
}

model LayoutTemplate {
  id         String   @id @default(cuid())
  name       String
  thumbnail  String?
  category   String?
  structure  Json
  isPremium  Boolean  @default(false)
  usageCount Int      @default(0)
  rating     Float?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([category])
  @@map("layout_templates")
}

model SupportTicket {
  id           String          @id @default(cuid())
  userId       String
  subject      String
  description  String
  status       TicketStatus    @default(OPEN)
  priority     TicketPriority  @default(MEDIUM)
  category     String?
  orderId      Int?
  assignedTo   String?
  resolvedAt   DateTime?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  assignedUser User?           @relation("AssignedTickets", fields: [assignedTo], references: [id])
  user         User            @relation("UserTickets", fields: [userId], references: [id], onDelete: Cascade)
  messages     TicketMessage[]

  @@index([userId, status])
  @@index([status, priority])
  @@index([assignedTo])
  @@map("support_tickets")
}

model TicketMessage {
  id          String        @id @default(cuid())
  ticketId    String
  senderId    String
  content     String
  isInternal  Boolean       @default(false)
  attachments Json?
  createdAt   DateTime      @default(now())
  sender      User          @relation("TicketMessages", fields: [senderId], references: [id], onDelete: Cascade)
  ticket      SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId, createdAt])
  @@map("ticket_messages")
}

model Theme {
  id          String   @id @default(uuid())
  name        String
  layoutType  String   @unique(map: "theme_layout_type_unique")
  status      String   @default("inactive")
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("themes")
}

model cart_items {
  id                    String   @id @default(cuid())
  cartId           String
  productId        String
  variantId        String
  quantity         Int            @default(1)
  price            Float
  compareAtPrice   Float?
  appliedOfferId   String?
  isSelected       Boolean        @default(true)
  notes            String?
  addedAt          DateTime       @default(now())
  updatedAt        DateTime       @default(now())
  lastSelectedAt   DateTime?
  carts            carts          @relation(fields: [cartId], references: [id], onDelete: Cascade)
  products         Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  product_variants ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([cartId, variantId])
  @@index([addedAt])
  @@index([isSelected])
  @@index([productId])
  @@index([variantId])
}

model carts {
  id                    String   @id @default(cuid())
  userId            String?            @unique
  sessionId         String             @unique
  fingerprint       String?
  isGuest           Boolean            @default(false)
  expiresAt         DateTime?
  lastActivityAt    DateTime           @default(now())
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @default(now())
  cart_items        cart_items[]
  users             User?              @relation(fields: [userId], references: [id], onDelete: Cascade)
  checkout_sessions CheckoutSession?

  @@index([expiresAt])
  @@index([fingerprint])
  @@index([sessionId])
  @@index([userId])
}
model wishlist_items {
  id                    String   @id @default(cuid())
  wishlistId       String
  productId        String
  variantId        String?
  priority         Int             @default(0)
  notes            String?
  priceWhenAdded   Float
  notifyOnDiscount Boolean         @default(false)
  notifyOnRestock  Boolean         @default(false)
  addedAt          DateTime        @default(now())
  products         Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  product_variants ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)
  wishlists        wishlists       @relation(fields: [wishlistId], references: [id], onDelete: Cascade)

  @@unique([wishlistId, productId, variantId])
  @@index([productId])
  @@index([wishlistId, priority])
}

model wishlists {
  id                    String   @id @default(cuid())
  userId         String           @unique
  name           String           @default("My Wishlist")
  isDefault      Boolean          @default(true)
  isPublic       Boolean          @default(false)
  shareToken     String?          @unique
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now())
  wishlist_items wishlist_items[]
  users          User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}
model CheckoutSession  {
  id                    String   @id @default(cuid())
  cartId                String          @unique
  orderId               String?         @unique
  selectedItemIds       String[]
  selectedItemCount     Int
  selectedItemsValue    Float
  shippingAddressId     String?
  shippingMethodId      String?
  shippingCost          Float           @default(0)
  estimatedDeliveryDays Int?
  subtotal              Float
  discount              Float           @default(0)
  tax                   Float           @default(0)
  total                 Float
  status                CheckoutStatus  @default(INITIATED)
  expiresAt             DateTime
  createdAt             DateTime        @default(now())
  updatedAt             DateTime
  completedAt           DateTime?
  carts                 carts           @relation(fields: [cartId], references: [id], onDelete: Cascade)
  orders                Order?          @relation(fields: [orderId], references: [id])
  shippingAddress       UserAddress? @relation(fields: [shippingAddressId], references: [id])

  @@index([createdAt])
  @@index([status])
}

model CourierCredential {
  id                 String   @id @default(cuid())
  courierProviderId String
  vendorId          String?
  environment       Environment       @default(PRODUCTION)
  clientId          String?
  clientSecret      String?
  accessToken       String?
  refreshToken      String?
  tokenExpiresAt    DateTime?
  apiKey            String?
  bearerToken       String?
  username          String?
  password          String?
  storeId           String?
  merchantId        String?
  isActive          Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  courier_providers CourierProviders @relation(fields: [courierProviderId], references: [id], onDelete: Cascade)
  vendors           Vendor?           @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([courierProviderId, vendorId, environment])
  @@index([vendorId, isActive])
  @@map("courier_credentials")
}

model CourierOrder  {
  id                       String   @id @default(cuid())
  orderId                  Int                        @unique
  courierProviderId        String
  vendorId                 String
  courierTrackingId        String?                    @unique
  courierOrderId           String?
  consignmentId            String?
  pickupStoreId            String?
  recipientName            String
  recipientPhone           String
  recipientAddress         String
  deliveryLocationId       String
  itemType                 String
  deliveryType             String
  itemWeight               Float
  itemQuantity             Int
  itemDescription          String?
  specialInstruction       String?
  codAmount                Float                      @default(0)
  deliveryCharge           Float
  codCharge                Float                      @default(0)
  totalCharge              Float
  status                   CourierOrderStatus         @default(PENDING_PICKUP)
  courierStatus            String?
  lastStatusUpdate         DateTime                   @default(now())
  createdAt                DateTime                   @default(now())
  pickedUpAt               DateTime?
  inTransitAt              DateTime?
  deliveredAt              DateTime?
  returnedAt               DateTime?
  cancelledAt              DateTime?
  webhookReceivedAt        DateTime?
  courier_providers        CourierProviders          @relation(fields: [courierProviderId], references: [id])
  locations                locations                  @relation(fields: [deliveryLocationId], references: [id])
  vendors                  Vendor                     @relation(fields: [vendorId], references: [id])
  vendorOrders             VendorOrder[]
  courier_tracking_history CourierTrackingHistory[]

  @@index([courierTrackingId])
  @@index([orderId])
  @@index([status, lastStatusUpdate])
  @@index([vendorId, status])
   @@map("courier_orders")
}

model CourierPriceCache {
  id                                                      String   @id @default(cuid())
  courierProviderId                                       String
  vendorId                                                String?
  fromLocationId                                          String
  toLocationId                                            String
  weight                                                  Float
  deliveryType                                            String
  itemType                                                String
  codAmount                                               Float             @default(0)
  basePrice                                               Float
  weightCharge                                            Float             @default(0)
  codCharge                                               Float             @default(0)
  additionalCharges                                       Float             @default(0)
  discount                                                Float             @default(0)
  totalPrice                                              Float
  calculatedAt                                            DateTime          @default(now())
  expiresAt                                               DateTime
  courier_providers                                       CourierProviders @relation(fields: [courierProviderId], references: [id], onDelete: Cascade)
  locations_courier_price_cache_fromLocationIdTolocations locations         @relation("courier_price_cache_fromLocationIdTolocations", fields: [fromLocationId], references: [id])
  locations_courier_price_cache_toLocationIdTolocations   locations         @relation("courier_price_cache_toLocationIdTolocations", fields: [toLocationId], references: [id])

  @@unique([courierProviderId, vendorId, fromLocationId, toLocationId, weight, deliveryType, itemType, codAmount])
  @@index([expiresAt])
   @@map("courier_price_cache")
}

model CourierPricingRules {
  id                                                        String   @id @default(cuid())
  courierProviderId                                         String
  vendorId                                                  String?
  deliveryType                                              String
  deliveryTypeCode                                          String?
  itemType                                                  String
  itemTypeCode                                              String?
  fromLocationId                                            String?
  toLocationId                                              String?
  minWeight                                                 Float             @default(0)
  maxWeight                                                 Float?
  basePrice                                                 Float
  perKgCharge                                               Float             @default(0)
  codChargeType                                             String?
  codChargeValue                                            Float?
  fuelSurcharge                                             Float?            @default(0)
  validFrom                                                 DateTime          @default(now())
  validTo                                                   DateTime?
  isActive                                                  Boolean           @default(true)
  priority                                                  Int               @default(100)
  createdAt                                                 DateTime          @default(now())
  updatedAt                                                 DateTime
  courier_providers                                         CourierProviders @relation(fields: [courierProviderId], references: [id], onDelete: Cascade)
  locations_courier_pricing_rules_fromLocationIdTolocations locations?        @relation("courier_pricing_rules_fromLocationIdTolocations", fields: [fromLocationId], references: [id])
  locations_courier_pricing_rules_toLocationIdTolocations   locations?        @relation("courier_pricing_rules_toLocationIdTolocations", fields: [toLocationId], references: [id])
  vendors                                                   Vendor?           @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([courierProviderId, vendorId, isActive])
  @@index([deliveryType, itemType])
   @@map("courier_pricing_rules")
}

model CourierProviders {
  id                        String                      @id 
  name                      String
  slug                      String                      @unique
  displayName               String?                     
  description               String?                     
  logo                      String?
  isActive                  Boolean                     @default(true)
  sandboxBaseUrl            String?
  productionBaseUrl         String
  authType                  CourierAuthType
  supportsCOD               Boolean                     @default(true)
  supportsTracking          Boolean                     @default(true)
  supportsBulkOrder         Boolean                     @default(false)
  supportsWebhook           Boolean                     @default(false)
  priority                  Int                         @default(100)
  isPreferred               Boolean                     @default(false)
  statusMappings            Json
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  courier_credentials       CourierCredential[]
  courier_orders            CourierOrder[]
  courier_price_cache       CourierPriceCache[]
  courier_pricing_rules     CourierPricingRules[]
  courier_serviceable_areas CourierServicableAreas[]

  @@index([isActive, priority])
   @@map("courier_providers")
}

model CourierServicableAreas {
  id                    String   @id @default(cuid())
  courierProviderId     String
  locationId            String
  courierCityId         String?
  courierZoneId         String?
  courierAreaId         String
  courierCityName       String?
  courierZoneName       String?
  courierAreaName       String
  homeDeliveryAvailable Boolean           @default(true)
  pickupAvailable       Boolean           @default(false)
  rawData               Json?
  lastSyncedAt          DateTime          @default(now())
  isActive              Boolean           @default(true)
  courier_providers     CourierProviders @relation(fields: [courierProviderId], references: [id], onDelete: Cascade)
  locations             locations         @relation(fields: [locationId], references: [id])

  @@unique([courierProviderId, courierAreaId])
  @@index([courierProviderId, locationId])
  @@index([locationId])
  @@map("courier_serviceable_areas")
}

model CourierTrackingHistory {
  id             String             @id @default(cuid())
  courierOrderId String
  status         CourierOrderStatus
  courierStatus  String
  messageEn      String
  messageBn      String?
  location       String?
  timestamp      DateTime
  rawData        Json?
  createdAt      DateTime           @default(now())
  courier_orders CourierOrder     @relation(fields: [courierOrderId], references: [id], onDelete: Cascade)

  @@index([courierOrderId, timestamp])
   @@map("courier_tracking_history")
}

model locations {
  id                                                                    String                      @id @default(cuid())  
  name                                                                  String
  name_local                                                            String?
  parent_id                                                             String?
  level                                                                 location_level
  external_code                                                         String?                     @unique
  is_cod_supported                                                      Boolean?
  is_dg_cod_supported                                                   Boolean?
  is_leaf_node                                                          Boolean                     @default(false)
  sort_order                                                            Int?
  created_at                                                            DateTime                    @default(now()) @db.Timestamptz(6)
  updated_at                                                            DateTime                    @default(now()) @updatedAt @db.Timestamptz(6)  
  
  courier_orders                                                        CourierOrder[]
  courier_price_cache_courier_price_cache_fromLocationIdTolocations     CourierPriceCache[]       @relation("courier_price_cache_fromLocationIdTolocations")
  courier_price_cache_courier_price_cache_toLocationIdTolocations       CourierPriceCache[]       @relation("courier_price_cache_toLocationIdTolocations")
  courier_pricing_rules_courier_pricing_rules_fromLocationIdTolocations CourierPricingRules[]     @relation("courier_pricing_rules_fromLocationIdTolocations")
  courier_pricing_rules_courier_pricing_rules_toLocationIdTolocations   CourierPricingRules[]     @relation("courier_pricing_rules_toLocationIdTolocations")
  courier_serviceable_areas                                             CourierServicableAreas[]
  locations                                                             locations?                  @relation("locationsTolocations", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_parent")
  other_locations                                                       locations[]                 @relation("locationsTolocations")
  user_addresses                                                        UserAddress[]
  order_addresses                                                       OrderAddress[]
  vendorWarehouses VendorWarehouse[] @relation("LocationToVendorWarehouse")

  
  @@index([level])
  @@index([parent_id])
  @@index([is_leaf_node])
  @@index([external_code])
}
model VendorWarehouse {
  id             String        @id @default(cuid())
  vendorId       String
  locationId     String        
  code           String?
  name           String?
  address        String?
  email          String?
  phone          String?
  isDefault      Boolean       @default(false)
  type           WarehouseType @default(PICKUP)

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  vendor         Vendor        @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  location locations @relation("LocationToVendorWarehouse", fields: [locationId], references: [id])

  holidays       WarehouseHoliday[]

  @@unique([vendorId, code, type])
  @@index([vendorId, isDefault])
  @@index([locationId])
  @@map("vendor_warehouses")
}


model WarehouseHoliday {
  id            String    @id @default(cuid())
  warehouseId   String
  start         DateTime
  end           DateTime
  isOpen        Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt

  warehouse     VendorWarehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@map("vendor_warehouse_holidays")
}

enum WarehouseType {
  PICKUP
  RETURN
}

model UserAddress {
  id                String              @id @default(cuid())  
  userId            String
  locationId        String
  fullName          String
  phone             String
  addressLine1      String
  addressLine2      String?
  landmark          String?
  isDefault         Boolean             @default(false)
  addressType       String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt  
  
  checkout_sessions CheckoutSession[]
  locations         locations           @relation(fields: [locationId], references: [id])
  users             User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([locationId])
  @@index([userId])
  @@index([userId, isDefault])  
  @@map("user_addresses")
}
model OrderAddress {
  id                   String     @id @default(cuid())
  orderId              String     @unique    
  locationId           String    
  country              String
  state                String
  zone                 String?
  city                 String
  address              String
  landmark             String?
  receiverFullName     String
  phone                String

  latitude             Float?
  longitude            Float?
  addressLineGeoCoding String?

  order                Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  location locations @relation(fields: [locationId], references: [id])

  @@map("order_addresses")
}



model Notification {
  id              String                 @id @default(cuid())

  type            NotificationType
  title           String
  message         String

  /** Receiver */
  targetType      NotificationTargetType
  targetId        String                // userId / vendorId / employeeId

  /** Optional relations */
  orderId         String?
  courierOrderId  String?
  productId       String?

  /** Navigation */
  actionUrl       String?               // e.g. /vendor/orders/123

  /** State */
  isRead          Boolean               @default(false)
  readAt          DateTime?

  /** Extra payload */
  meta            Json?

  createdAt       DateTime              @default(now())

  @@index([targetType, targetId])
  @@index([type])
  @@index([isRead])
}

// ============================================
// 1. CHART OF ACCOUNTS
// ============================================

model ChartOfAccount {
  id            String        @id @default(cuid())

  // Auto-generated by server
  code          String

  name          String

  // Accounting structure
  accountClass  AccountClass
  accountType   AccountTypeInAccounting
  group         AccountGroup?

  // Auto-derived (DO NOT accept from client)
  nature        AccountNature

  // Entity ownership
  entityType    EntityType
  entityId      String?        // NULL = Admin, vendorId = Vendor

  // Control flags
  isSystem      Boolean        @default(false)
  isActive      Boolean        @default(true)
  canDelete     Boolean        @default(true)

  description   String?

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  ledgerEntries LedgerEntry[]

  @@unique([code, entityType, entityId])
  @@index([entityType, entityId])
  @@index([accountClass])
  @@index([accountType])
  @@index([isActive])
  @@map("chart_of_accounts")
}

// ============================================
// 2. ACCOUNTING PERIOD
// ============================================

model AccountingPeriod {
  id          String      @id @default(cuid())
  periodName  String      // "FY 2024-25", "Q1 2025"
  periodType  PeriodType  // MONTHLY, QUARTERLY, YEARLY
  startDate   DateTime
  endDate     DateTime
  
  // Entity
  entityType  EntityType
  entityId    String?
  
  // Status
  isActive    Boolean     @default(true)
  isClosed    Boolean     @default(false)
  closedAt    DateTime?
  closedBy    String?
  
  // Opening/Closing voucher references
  openingVoucherId String?
  closingVoucherId String?
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  @@unique([periodName, entityType, entityId])
  @@index([entityType, entityId])
  @@index([startDate, endDate])
  @@index([isClosed])
  @@map("accounting_periods")
}

// ============================================
// 3. VOUCHER SYSTEM (FIXED)
// ============================================

model Voucher {
  id                String        @id @default(cuid())
  voucherNumber     String        @unique
  voucherType       VoucherType
  
  // Auto or Manual
  isAuto            Boolean       @default(false)
  eventType         EventType?
  
  // Reference tracking
  referenceType     String?       // "order", "payment", "settlement"
  referenceId       String?
  
  // Entity
  entityType        EntityType
  entityId          String?
  
  // Status & Locking
  status            VoucherStatus @default(DRAFT)
  isLocked          Boolean       @default(false)
  isReversed        Boolean       @default(false)
  reversalOfId      String?       // Points to original voucher if this is reversal
  reversedById      String?       // Points to reversal voucher if this was reversed
  
  // Amounts (MUST MATCH ledger entries)
  // Bank-grade precision
  totalDebit        Decimal       @default(0) @db.Decimal(18,4)
  totalCredit       Decimal       @default(0) @db.Decimal(18,4)
  
  // Dates
  voucherDate       DateTime      @default(now())
  postingDate       DateTime?     // When status changed to POSTED
  
  // Description
  narration         String
  
  // Audit trail
  createdBy         String?
  updatedBy         String?
  lockedBy          String?
  lockedAt          DateTime?
  postedBy          String?
  
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  // Relations
  ledgerEntries     LedgerEntry[]
  
  // âš ï¸ REMOVED WRONG UNIQUE CONSTRAINT
  // Multiple vouchers can reference same order (payment, delivery, refund)
  
  @@index([voucherNumber])
  @@index([voucherType, voucherDate])
  @@index([entityType, entityId])
  @@index([status])
  @@index([referenceType, referenceId])
  @@index([eventType])
  @@index([isLocked])
  @@map("vouchers")
}
model VoucherDraftEntry {
  id            String   @id @default(cuid())

  voucherId     String
  accountId     String

  debitAmount   Decimal  @db.Decimal(18,4)
  creditAmount  Decimal  @db.Decimal(18,4)

  description   String?
  referenceType String?
  referenceId   String?
  costCenter    String?
  department    String?

  @@index([voucherId])
  @@index([voucherId, accountId])
  @@index([referenceType, referenceId])
  @@map("voucher_draft_entries")
}

// ============================================
// 4. LEDGER ENTRIES (ENHANCED)
// ============================================

model LedgerEntry {
  id            String          @id @default(cuid())
  
  // Voucher reference
  voucherId     String
  voucher       Voucher         @relation(fields: [voucherId], references: [id], onDelete: Restrict)
  
  // Account reference
  accountId     String
  account       ChartOfAccount  @relation(fields: [accountId], references: [id], onDelete: Restrict)
  
  // Amounts (CRITICAL: Only ONE should be non-zero)
  // Bank-grade precision for fractional VAT/fees
  debitAmount   Decimal         @default(0) @db.Decimal(18,4)
  creditAmount  Decimal         @default(0) @db.Decimal(18,4)
  
  // Entity
  entityType    EntityType
  entityId      String?
  
  // Reference (order, payment, etc.)
  referenceType String?
  referenceId   String?
  
  // Line description
  description   String?
  
  // Date
  entryDate     DateTime        @default(now())
  
  // Cost center / Department (optional)
  costCenter    String?
  department    String?
  
  createdAt     DateTime        @default(now())
  
  @@index([voucherId])
  @@index([accountId, entryDate])
  @@index([entityType, entityId])
  @@index([referenceType, referenceId])
  @@index([entryDate])
  @@map("ledger_entries")
}

// ============================================
// 5. SSLCOMMERZ TRANSACTION (ENHANCED)
// ============================================

model SSLCommerzTransaction {
  id                    String              @id @default(cuid())
  
  // SSLCommerz identifiers
  tranId                String              @unique
  valId                 String?             @unique
  bankTranId            String?
  storeTranId           String?             // Additional tracking
  
  // Card details
  cardType              String?
  cardIssuer            String?
  cardBrand             String?
  cardNo                String?             // Masked
  
  // Order reference
  orderId               Int
  vendorId              String
  customerId            String?
  
  // Amounts
  amount                Decimal             @db.Decimal(18,2)
  currencyCode          String              @default("BDT")
  
  // Gateway charges (filled during settlement)
  gatewayFee            Decimal?            @db.Decimal(18,2)
  vatAmount             Decimal?            @db.Decimal(18,2)
  netAmount             Decimal?            @db.Decimal(18,2)
  
  // Status
  status                SSLCommerzStatus
  paymentStatus         String?             // VALID, FAILED, CANCELLED
  failedReason          String?
  riskLevel             String?
  riskTitle             String?
  
  // Settlement
  isSettled             Boolean             @default(false)
  settlementDate        DateTime?
  settlementBatchId     String?
  
  // Refund tracking
  isRefunded            Boolean             @default(false)
  refundAmount          Decimal?            @db.Decimal(18,2)
  refundReason          String?
  refundedAt            DateTime?
  sslRefundRefId        String?
  
  // Chargeback
  isChargeback          Boolean             @default(false)
  chargebackAmount      Decimal?            @db.Decimal(18,2)
  chargebackDate        DateTime?
  
  // CRITICAL: Voucher linkages
  paymentVoucherId      String?
  settlementVoucherId   String?
  refundVoucherId       String?
  chargebackVoucherId   String?
  
  // Raw data (for audit & reconciliation)
  ipnPayload            Json?
  validationData        Json?
  settlementData        Json?
  
  // Webhook handling (CRITICAL for idempotency)
  webhookProcessed      Boolean             @default(false)
  webhookProcessedAt    DateTime?
  webhookAttempts       Int                 @default(0)
  lastWebhookError      String?
  
  // Timestamps
  initiatedAt           DateTime            @default(now())
  successAt             DateTime?
  failedAt              DateTime?
  validatedAt           DateTime?
  
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@index([orderId])
  @@index([vendorId])
  @@index([status])
  @@index([isSettled])
  @@index([webhookProcessed])
  @@index([settlementBatchId])
  @@index([tranId, valId])
  @@map("sslcommerz_transactions")
}

// ============================================
// 6. VENDOR PAYABLE (ENHANCED)
// ============================================

model VendorPayable {
  id                String      @id @default(cuid())
  vendorId          String      @unique
  
  // Amounts (cached from ledger - READ ONLY)
  totalSales        Decimal     @default(0) @db.Decimal(18,2)
  totalCommission   Decimal     @default(0) @db.Decimal(18,2)
  totalRefunds      Decimal     @default(0) @db.Decimal(18,2)
  totalPayable      Decimal     @default(0) @db.Decimal(18,2)
  totalPaid         Decimal     @default(0) @db.Decimal(18,2)
  balance           Decimal     @default(0) @db.Decimal(18,2)
  
  // Counters
  totalOrders       Int         @default(0)
  totalPayouts      Int         @default(0)
  
  // Last activity
  lastSaleAt        DateTime?
  lastPayoutAt      DateTime?
  lastRefundAt      DateTime?
  lastSyncedAt      DateTime    @default(now())
  
  // Next payout schedule
  nextPayoutDate    DateTime?
  
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  @@map("vendor_payables")
}

// ============================================
// 7. PLATFORM RECEIVABLES
// ============================================

model PlatformReceivable {
  id                String              @id @default(cuid())
  
  // Source type
  sourceType        ReceivableSource
  sourceId          String?             // SSL tranId, Courier ID, etc.
  
  // Amounts
  totalReceivable   Decimal             @default(0) @db.Decimal(18,2)
  totalReceived     Decimal             @default(0) @db.Decimal(18,2)
  totalFees         Decimal             @default(0) @db.Decimal(18,2)
  balance           Decimal             @default(0) @db.Decimal(18,2)
  
  // Settlement info
  lastSettlementAt  DateTime?
  nextSettlementAt  DateTime?
  
  // Sync
  lastSyncedAt      DateTime            @default(now())
  
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  
  @@unique([sourceType, sourceId])
  @@index([sourceType])
  @@map("platform_receivables")
}

// ============================================
// 8. SETTLEMENT BATCH
// ============================================

model SettlementBatch {
  id                  String            @id @default(cuid())
  batchNumber         String            @unique
  
  // Period
  startDate           DateTime
  endDate             DateTime
  settlementDate      DateTime
  
  // Provider
  provider            String            @default("SSLCOMMERZ")
  
  // Amounts
  grossAmount         Decimal           @db.Decimal(18,2)
  totalFee            Decimal           @db.Decimal(18,2)
  totalVAT            Decimal           @db.Decimal(18,2)
  netAmount           Decimal           @db.Decimal(18,2)
  
  // Transaction counts
  transactionCount    Int               @default(0)
  successCount        Int               @default(0)
  refundCount         Int               @default(0)
  
  // Voucher
  voucherId           String?           @unique
  
  // Bank details
  bankAccountCode     String?
  bankReference       String?
  bankReceivedAmount  Decimal?          @db.Decimal(18,2)
  
  // Status
  status              SettlementStatus
  reconciledAt        DateTime?
  reconciledBy        String?
  
  // Files
  settlementFile      String?
  bankStatement       String?
  
  // Discrepancy
  hasDiscrepancy      Boolean           @default(false)
  discrepancyAmount   Decimal?          @db.Decimal(18,2)
  discrepancyNotes    String?
  
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  
  @@index([settlementDate])
  @@index([status])
  @@index([provider])
  @@map("settlement_batches")
}

// ============================================
// 9. COMMISSION RECORDS
// ============================================

model CommissionRecord {
  id                String              @id @default(cuid())
  
  // Order reference
  orderId           Int
  orderItemId       String?
  vendorId          String
  
  // Product
  productId         String
  productName       String
  quantity          Int
  
  // Amounts
  productPrice      Decimal             @db.Decimal(18,2)
  totalAmount       Decimal             @db.Decimal(18,2)
  commissionRate    Decimal             @db.Decimal(5,2)
  commissionAmount  Decimal             @db.Decimal(18,2)
  
  // VAT (if applicable)
  vatOnCommission   Decimal?            @db.Decimal(18,2)
  
  // Voucher
  voucherId         String?
  
  // Status
  status            CommissionStatus    @default(PENDING)
  recognizedAt      DateTime?
  settledAt         DateTime?
  reversedAt        DateTime?
  
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  
  @@index([vendorId, status])
  @@index([orderId])
  @@index([status])
  @@map("commission_records")
}

// ============================================
// 10. REFUND RECORDS
// ============================================

model RefundRecord {
  id                  String              @id @default(cuid())
  refundNumber        String              @unique
  
  // Original transaction
  sslTranId           String
  orderId             Int
  vendorId            String
  customerId          String
  
  // Refund details
  refundType          RefundType
  originalAmount      Decimal             @db.Decimal(18,2)
  refundAmount        Decimal             @db.Decimal(18,2)
  refundReason        String
  
  // Commission
  commissionReversed  Decimal?            @db.Decimal(18,2)
  
  // SSLCommerz refund
  sslRefundRefId      String?             @unique
  sslRefundStatus     String?
  
  // Voucher
  reversalVoucherId   String?
  
  // Approvals
  status              RefundStatus
  initiatedBy         String?
  approvedBy          String?
  rejectedBy          String?
  rejectionReason     String?
  
  // Dates
  initiatedAt         DateTime            @default(now())
  approvedAt          DateTime?
  processedAt         DateTime?
  completedAt         DateTime?
  rejectedAt          DateTime?
  
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  
  @@index([sslTranId])
  @@index([orderId])
  @@index([vendorId])
  @@index([status])
  @@map("refund_records")
}

// ============================================
// 11. ACCOUNTING AUDIT
// ============================================

model AccountingAudit {
  id            String        @id @default(cuid())
  
  // Action
  action        AuditAction
  entityName    String        // "voucher", "ledger_entry"
  entityId      String
  
  // Changes
  oldData       Json?
  newData       Json?
  
  // User
  userId        String?
  userName      String?
  userRole      String?
  
  // Context
  ipAddress     String?
  userAgent     String?
  
  // Timestamp
  createdAt     DateTime      @default(now())
  
  @@index([entityName, entityId])
  @@index([createdAt])
  @@index([userId])
  @@index([action])
  @@map("accounting_audit")
}

// ============================================
// 12. BALANCE SHEET CACHE (OPTIONAL)
// ============================================

model AccountBalance {
  id              String      @id @default(cuid())
  
  // Account
  accountId       String
  entityType      EntityType
  entityId        String?
  
  // Period
  periodStart     DateTime
  periodEnd       DateTime
  
  // Balances
  openingBalance  Decimal     @db.Decimal(18,2)
  totalDebit      Decimal     @db.Decimal(18,2)
  totalCredit     Decimal     @db.Decimal(18,2)
  closingBalance  Decimal     @db.Decimal(18,2)
  
  // Last sync
  lastSyncedAt    DateTime    @default(now())
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@unique([accountId, periodStart, periodEnd, entityType, entityId])
  @@index([accountId])
  @@index([periodStart, periodEnd])
  @@map("account_balances")
}

model FooterSettings {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Company Info
  companyName  String
  address      String
  email        String
  phone1       String
  phone2       String?
  dbidNumber   String
  tradeLicense String

  // Newsletter
  newsletterTitle       String
  newsletterDescription String

  // Social Media
  socialMediaTitle String
  twitterUrl       String?
  facebookUrl      String?
  youtubeUrl       String?
  instagramUrl     String?
  whatsappUrl      String?

  // Bottom Bar
  copyrightText      String
  paymentBannerImage String

  // Only one active settings record
  isActive Boolean @default(true)

  // Dynamic columns/sections
  columns FooterColumn[]

  @@map("footer_settings")
}

model FooterColumn {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title       String
  slug        String // e.g., "get-to-know-us", "customer-service", "legal"
  displayOrder Int    @default(0) // To control the order of columns
  isVisible   Boolean @default(true)

  footerSettingsId String
  footerSettings   FooterSettings @relation(fields: [footerSettingsId], references: [id], onDelete: Cascade)

  // Dynamic elements/links under this column
  elements FooterElement[]

  @@map("footer_columns")
}

model FooterElement {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  label        String
  url          String
  displayOrder Int     @default(0) // To control the order of elements
  isVisible    Boolean @default(true)
  openInNewTab Boolean @default(false)

  footerColumnId String
  footerColumn   FooterColumn @relation(fields: [footerColumnId], references: [id], onDelete: Cascade)

  @@map("footer_elements")
}
enum UserRole {
  CUSTOMER
  VENDOR
  EMPLOYEE
  ADMIN
}

enum AccountType {
  INDIVIDUAL
  BUSINESS
}

enum BusinessType {
  PROPRIETORSHIP
  LIMITED_COMPANY
  PARTNERSHIP_FIRM
}

enum VerificationStatus {
  PENDING
  UNDER_REVIEW
  VERIFIED
  REJECTED
  SUSPENDED
}

enum VendorStatus {
  PENDING
  ACTIVE
  SUSPENDED
  DEACTIVATED
}

enum DocumentType {
  NATIONAL_ID_FRONT
  NATIONAL_ID_BACK
  PASSPORT_FRONT
  PASSPORT_BACK
  TRADE_LICENSE
  RJSC_REGISTRATION
  TIN_CERTIFICATE
  VAT_CERTIFICATE
  OTHER
}

enum DocumentVerificationStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
  EXPIRED
}

enum SubscriptionPlan {
  FREE
  BASIC
  PREMIUM
  ENTERPRISE
}

enum PayoutStatus {
  PENDING
  PAID
  FAILED
}

enum ConversationType {
  PRODUCT_INQUIRY
  VENDOR_SUPPORT
  USER_SUPPORT
  DELIVERY_CHAT
  GENERAL_CHAT
}

enum ParticipantType {
  CUSTOMER
  VENDOR
  ADMIN
  EMPLOYEE
  DELIVERY
}

enum MessageStatus {
  SENDING
  SENT
  DELIVERED
  SEEN
}

enum ProductApprovalStatus {
  PENDING
  ACTIVE
  REJECTED
  DRAFT
  INACTIVE
}

enum AttributeType {
  TEXT
  NUMBER
  BOOLEAN
  SELECT
}

enum SpecificationType {
  TEXT
  NUMBER
  BOOLEAN
  SELECT
}

enum WarrantyUnit {
  DAYS
  MONTHS
  YEARS
}

enum WarrantyType {
  FINIXMART_WARRANTY
  LOCAL_WARRANTY
  AGENT_WARRANTY
  BRAND_WARRANTY
  SELLER_WARRANTY
  LOCAL_SELLER_WARRANTY
  INTERNATIONAL_WARRANTY
  INTERNATIONAL_MANUFACTURER_WARRANTY
  INTERNATIONAL_SELLER_WARRANTY
  NON_LOCAL_WARRANTY
  NO_WARRANTY
  NOT_APPLICABLE
  ORIGINAL_PRODUCT
}

enum WeightUnit {
  KG
  G
}

enum DangerousGoods {
  NONE
  CONTAINS
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  PACKAGING
  SHIPPED
  DELIVERED
  RETURNED
  FAILED_TO_DELIVER
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}



enum ShippingStatus {
  PENDING
  DISPATCHED
  IN_TRANSIT
  DELIVERED
  RETURNED
}

enum SliderType {
  HOMEPAGE
  VENDORPAGE
}

enum TermsType {
  GENERAL
  PRIVACY_POLICY
  VENDOR_AGREEMENT
  CUSTOMER_TERMS
  DELIVERY_TERMS
  RETURN_POLICY
}

enum WalletTransactionType {
  CREDIT
  DEBIT
  REFUND
  ADJUSTMENT
}

enum LoyaltyTransactionType {
  EARNED
  REDEEMED
  EXPIRED
  ADJUSTED
}

enum OfferStatus {
  PENDING
  APPROVED
  REJECTED
  ACTIVE
  PAUSED
  EXPIRED
}

enum OfferType {
  REGULAR_DISCOUNT
  VOUCHER
  COUNTDOWN_DEAL
  FLASH_SALE
  BUY_X_GET_Y
  FREE_SHIPPING
  BUNDLE_DEAL
  SEASONAL_SALE
  LOYALTY_REWARD
  REFERRAL_BONUS
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
}

enum CreatorType {
  ADMIN
  VENDOR
  SYSTEM
}

enum CouponType {
  PERCENT
  FIXED
}

enum ComponentType {
  STORE_BANNER
  CATEGORY_SLIDER
  CATEGORY_GRID
  BANNER
  PRODUCT_CAROUSEL
  PRODUCT_GRID
  FEATURED_PRODUCTS
  COUNTDOWN_TIMER
  VOUCHER_PROMOTION
}

enum BannerType {
  SINGLE_BANNER
  DOUBLE_BANNER
  THREE_BANNER
  FOUR_BANNER
  FIVE_BANNER
  SLIDER_BANNER
  SLIDER_WITH_LEFT_BANNER
}

enum BannerLayout {
  HORIZONTAL
  VERTICAL
  GRID
  MASONRY
}

enum CategoryLayout {
  SLIDER
  GRID
  LIST
}

enum TimerPosition {
  TOP_LEFT
  TOP_RIGHT
  TOP_CENTER
  BOTTOM_LEFT
  BOTTOM_RIGHT
  BOTTOM_CENTER
  CENTER
  OVERLAY_TOP
  OVERLAY_BOTTOM
}

enum BackgroundType {
  SOLID
  LINEAR_GRADIENT
  RADIAL_GRADIENT
  IMAGE
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
  REOPENED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum CheckoutStatus {
  INITIATED
  SHIPPING_INFO
  PAYMENT_INFO
  REVIEW
  COMPLETED
  EXPIRED
  ABANDONED
}

enum CourierAuthType {
  BEARER
  OAUTH2
  API_KEY
  BASIC
}

enum CourierOrderStatus {
  PENDING_PICKUP
  READY_FOR_PICKUP
  PICKUP_PENDING
  PICKED_UP
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  FAILED_DELIVERY
  RETURNING
  RETURNED
  CANCELLED
  ON_HOLD
}
 enum DeliveryType {
  STANDARD      
  EXPRESS       
  SAME_DAY      
  NEXT_DAY      
  ECONOMY      
}


enum Environment {
  SANDBOX
  PRODUCTION
}

enum FulfillmentStatus {
  UNFULFILLED
  PARTIALLY_FULFILLED
  FULFILLED
  SHIPPED
  DELIVERED
  RETURNED
  CANCELLED
}

enum location_level {
  COUNTRY
  DIVISION
  DISTRICT
  THANA
  UNION
}


enum NotificationType {
  ORDER
  COURIER
  PAYMENT
  PAYOUT
  PRODUCT
  PROMOTION
  FEATURE
  SYSTEM
  SECURITY
}

enum NotificationTargetType {
  USER
  VENDOR
  EMPLOYEE
}


// ============================================
// accounting part ENUMS
// ============================================

enum EntityType {
  ADMIN
  VENDOR
}
enum AccountClass {
  ASSET
  LIABILITY
  EQUITY
  INCOME
  EXPENSE
}

enum AccountTypeInAccounting {
  // Assets
  CURRENT_ASSET
  FIXED_ASSET
  NON_CURRENT_ASSET

  // Liabilities
  CURRENT_LIABILITY
  NON_CURRENT_LIABILITY

  // Others
  EQUITY
  INCOME
  EXPENSE
}


enum AccountNature {
  DEBIT
  CREDIT
}
enum AccountGroup {
  CASH_AND_BANK
  ACCOUNTS_RECEIVABLE
  FIXED_ASSETS
  INVESTMENT

  ACCOUNTS_PAYABLE
  EXPENSE_LIABILITIES
  STATUTORY
  LOANS

  ADMIN_EXPENSE
  DIRECT_EXPENSE
  OPERATING_EXPENSE
  NON_CASH_EXPENSE
}

enum VoucherType {
  SALES
  DELIVERY
  PAYMENT
  RECEIPT
  COMMISSION
  SETTLEMENT
  REFUND
  PAYOUT
  EXPENSE
  JOURNAL
  OPENING
  CLOSING
}

enum VoucherStatus {
  DRAFT
  POSTED
  LOCKED
  REVERSED
  CANCELLED
}

enum EventType {
  ORDER_CONFIRMED
  ORDER_DELIVERED
  PAYMENT_RECEIVED
  SETTLEMENT_RECEIVED
  VENDOR_PAYOUT
  REFUND_INITIATED
  REFUND_PROCESSED
  COMMISSION_RECOGNIZED
}

enum SSLCommerzStatus {
  PENDING
  INITIATED
  SUCCESS
  FAILED
  CANCELLED
  SETTLED
  REFUNDED
  CHARGEBACK
}

enum SettlementStatus {
  PENDING
  RECEIVED
  RECONCILED
  DISPUTED
}

enum CommissionStatus {
  PENDING
  RECOGNIZED
  SETTLED
  REVERSED
}

enum RefundType {
  FULL_REFUND
  PARTIAL_REFUND
  CHARGEBACK
  CUSTOMER_INITIATED
  VENDOR_INITIATED
  ADMIN_INITIATED
}

enum RefundStatus {
  PENDING
  APPROVED
  PROCESSING
  REFUNDED  
  FAILED
  REJECTED
  CANCELLED
}

enum ReceivableSource {
  SSL_COMMERZ
  BKASH
  NAGAD
  ROCKET
  UPAY
  COURIER_COD
  BANK_TRANSFER
  CASH
}

enum PeriodType {
  MONTHLY
  QUARTERLY
  YEARLY
  CUSTOM
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  POST
  LOCK
  UNLOCK
  REVERSE
  RECONCILE
  APPROVE
  REJECT
}
